---
/**
 * Teleport - Vim-style keyboard navigation for Astro sites.
 *
 * A thin Astro wrapper around createTeleport(). For vanilla JS usage,
 * import createTeleport directly from '@bearing-dev/teleport'.
 */
interface Props {
  /** CSS selector for navigable items (default: '.nav-item') */
  itemSelector?: string;
  /** CSS selector for sidebar container (enables visibility-aware navigation) */
  sidebarSelector?: string;
  /** Class to add to highlighted item (default: 'teleport-highlight') */
  highlightClass?: string;
  /** Enable wrapping at ends (default: true) */
  wrap?: boolean;
  /** What to do when j/k/Enter pressed while sidebar hidden (default: 'ignore') */
  whenHidden?: 'ignore' | 'show-sidebar';
}

const {
  itemSelector = '.nav-item',
  sidebarSelector,
  highlightClass = 'teleport-highlight',
  wrap = true,
  whenHidden = 'ignore',
} = Astro.props;
---

<teleport-config
  data-item-selector={itemSelector}
  data-sidebar-selector={sidebarSelector}
  data-highlight-class={highlightClass}
  data-wrap={wrap.toString()}
  data-when-hidden={whenHidden}
  style="display: none;"
></teleport-config>

<style is:global>
  .teleport-highlight {
    outline: 2px solid var(--color-accent, #3b82f6);
    outline-offset: -2px;
    background-color: var(--color-accent-dim, rgba(59, 130, 246, 0.1));
  }
</style>

<script>
  import { createTeleport, type TeleportInstance, type WhenHiddenBehavior } from './src/index.js';

  function setupTeleport(): TeleportInstance | null {
    const configEl = document.querySelector('teleport-config');
    if (!configEl) return null;

    const itemSelector = configEl.getAttribute('data-item-selector') || '.nav-item';
    const sidebarSelector = configEl.getAttribute('data-sidebar-selector') || undefined;
    const highlightClass = configEl.getAttribute('data-highlight-class') || 'teleport-highlight';
    const wrap = configEl.getAttribute('data-wrap') !== 'false';
    const whenHidden = (configEl.getAttribute('data-when-hidden') || 'ignore') as WhenHiddenBehavior;

    return createTeleport({
      itemSelector,
      sidebarSelector,
      highlightClass,
      wrap,
      whenHidden,
    });
  }

  // Run on initial load
  let teleport = setupTeleport();

  // Re-run after Astro page transitions
  document.addEventListener('astro:after-swap', () => {
    teleport?.destroy();
    teleport = setupTeleport();
  });
</script>
